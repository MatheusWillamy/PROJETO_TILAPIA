<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App</title>

    <!-- Fonte notificação - Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2? família=Radio+Canada:wght@500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="index.css">
    <script type="text/javascript" src="index.js"></script>
</head>
<body>
    
    
    <div class="correcao">
    </div>
    
    
    
    <div class='titulo'>
        <div id="perfil"></div>
    </div>
    
    <div id="main">
        <div class="navegacao_div">

            <div id="navegação">
                <div id="casa" class="navegacao">
                    <img src="../../componentes/imagens/navegação/casa.png" class="icone" >
                </div>
                <div id="dispositivos" class="navegacao">
                    <img src="../../componentes/imagens/navegação/cardapio.png" class="icone">
                </div>
                <div id="adicionar" class="navegacao" onclick="window.location='../adicionar/index.html'">
                    <img src="../../componentes/imagens/navegação/mais.png" class="icone">
                </div>
                <div id="configuracoes" class="navegacao" onclick="window.location='../definicoes/index.html'" >
                    <img src="../../componentes/imagens/navegação/definicoes.png" class="icone" >
                </div>
                <div id="sair" class="navegacao">
                    <img src="../../componentes/imagens/navegação/saida.png" class="icone">
                </div>
            </div>
        </div>
        
        
        
        
        <div id="linha_de_apresentacao">

            <div id="card_01" class="card">
                <div id="titulo_card">
                    <div id="nome_card">Tanque_01</div>
                    <div id="notificacao_card_01" class="notificacao_card" data-animaton = ''>ONLINE</div>
                </div>
                <div id="dados">
                    
                    <div class="serial_dado" id="ph_01">
                        PH = aguarde...
                    </div>
                    <div class="serial_dado" id="temperatura_01">
                        TEMPERATURA = aguarde...
                    </div>
                    <div class="serial_dado" id="turbidez_01">
                        TURBIDEZ = aguarde...
                    </div>  
                </div> 
            </div>
            <div id="card_02" class="card">
                <div id="titulo_card">
                    <div id="nome_card">Tanque_02</div>
                    <div id="notificacao_card_02" class="notificacao_card"></div>
                </div>
                <div id="dados">
                    <div id="serial_teste"></div>
                </div>  
            </div>
            <!-- <div id="card_03" class="card">
                <div id="titulo_card">
                    <div id="nome_card">Tanque_03</div>
                    <div id="notificacao_card_03" class="notificacao_card"></div>
                </div>
                <div id="dados">
                    <div id="serial_teste"></div>
                </div>
                <div id="tanque"></div>
            </div>
            <div id="card_04" class="card">
                <div id="titulo_card">
                    <div id="nome_card">Tanque_04</div>
                    <div id="notificacao_card_04" class="notificacao_card"></div>
                </div>
                <div id="dados">
                    <div id="serial_teste"></div>
                </div>
                <div id="tanque"></div>
            </div>
            <div id="card_05" class="card">
                <div id="titulo_card">
                    <div id="nome_card">Tanque_05</div>
                    <div id="notificacao_card_04" class="notificacao_card"></div>
                </div>
                <div id="dados">
                    <div id="serial_teste"></div>
                </div>
                <div id="tanque"></div>
            </div>
            <div id="card_06" class="card">
                <div id="titulo_card">
                    <div id="nome_card">Tanque_06</div>
                    <div id="notificacao_card_04" class="notificacao_card"></div>
                </div>
                <div id="dados">
                    <div id="serial_teste"></div>
                </div>
                <div id="tanque"></div>
            </div> -->
            <div class="botao_dados_card" id="botao_dados_card">
                ATUALIZAR
            </div>
        </div>

        <div id="teste_notificacao">
            <div>
                Tanque 1
                <div id="verde_1" class="botao_teste_notificacao_verde"></div>
                <div id="amarelo_1" class="botao_teste_notificacao_amarelo"></div>
                <div id="vermelho_1" class="botao_teste_notificacao_vermelho"></div>
            </div>
            <div>
                Tanque 2
                <div id="verde_2" class="botao_teste_notificacao_verde"></div>
                <div id="amarelo_2" class="botao_teste_notificacao_amarelo"></div>
                <div id="vermelho_2" class="botao_teste_notificacao_vermelho"></div>
            </div>
            <div>
                Tanque 3
                <div id="verde_3" class="botao_teste_notificacao_verde"></div>
                <div id="amarelo_3" class="botao_teste_notificacao_amarelo"></div>
                <div id="vermelho_3" class="botao_teste_notificacao_vermelho"></div>
            </div>
            <div>
                Tanque 4
                <div id="verde_4" class="botao_teste_notificacao_verde"></div>
                <div id="amarelo_4" class="botao_teste_notificacao_amarelo"></div>
                <div id="vermelho_4" class="botao_teste_notificacao_vermelho"></div>
            </div>
        </div>
        
    </div>
    
    <script> 
        
        //CRIANDO VARIAVEIS PARA O TESTE DE NOTIFICAÇÃO

        const card_01 = window.document.getElementById("card_01")
        const card_02 = window.document.getElementById("card_02")
        const card_03 = window.document.getElementById("card_03")
        const card_04 = window.document.getElementById("card_04")

        //NOTIFICAÇÃO CARDS
        const notificacao_card_01 = window.document.getElementById("notificacao_card_01")
        const notificacao_card_02 = window.document.getElementById("notificacao_card_02")
        const notificacao_card_03 = window.document.getElementById("notificacao_card_03")
        const notificacao_card_04 = window.document.getElementById("notificacao_card_04")

        //BOTOES TESTE
        const verde_1 = window.document.getElementById("verde_1")
        const amarelo_1 = window.document.getElementById("amarelo_1")
        const vermelho_1 = window.document.getElementById("vermelho_1")

        const verde_2 = window.document.getElementById("verde_2")
        const amarelo_2 = window.document.getElementById("amarelo_2")
        const vermelho_2 = window.document.getElementById("vermelho_2")

        const verde_3 = window.document.getElementById("verde_3")
        const amarelo_3 = window.document.getElementById("amarelo_3")
        const vermelho_3 = window.document.getElementById("vermelho_3")

        const verde_4 = window.document.getElementById("verde_4")
        const amarelo_4 = window.document.getElementById("amarelo_4")
        const vermelho_4 = window.document.getElementById("vermelho_4")

        // LISTAGEM DE EVENTOS NOTIFICAÇÕES 
        // BOTOES DE TESTE
        verde_1.onclick = function(){notificacao_verde(notificacao_card_01, card_02)}
        verde_2.onclick = function(){notificacao_verde(notificacao_card_02, card_02)}
        verde_3.onclick = function(){notificacao_verde(notificacao_card_03, card_03)}
        verde_4.onclick = function(){notificacao_verde(notificacao_card_04, card_04)}

        amarelo_1.onclick = function(){notificacao_amarelo(notificacao_card_01, card_01)}
        amarelo_2.onclick = function(){notificacao_amarelo(notificacao_card_02, card_02)}
        amarelo_3.onclick = function(){notificacao_amarelo(notificacao_card_03, card_03)}
        amarelo_4.onclick = function(){notificacao_amarelo(notificacao_card_04, card_04)}

        vermelho_1.onclick = function(){notificacao_vermelho(notificacao_card_01, card_01)}
        vermelho_2.onclick = function(){notificacao_vermelho(notificacao_card_02, card_02)}
        vermelho_3.onclick = function(){notificacao_vermelho(notificacao_card_03, card_03)}
        vermelho_4.onclick = function(){notificacao_vermelho(notificacao_card_04, card_04)}

        //FUNÇÕES DE NOTIFICAÇÃO
        function notificacao_verde(notificacao, card){
            notificacao.classList.remove("notificacao_animacao")
            
            notificacao.style.background = "rgb(0, 255, 55)"
            notificacao.style.boxShadow = "0px 8px 15px rgb(0, 255, 55)"
            notificacao.innerText = "ONLINE"
            card.style.boxShadow = "0px 8px 15px rgba(0, 0, 0, 0.42)"
            card.style.borderColor ="rgb(255, 255, 255)"
            window.console.log("verde") 
        }
        function notificacao_amarelo(notificacao, card){
            
            notificacao.style.background = "rgb(247, 222, 0)"
            notificacao.style.boxShadow = "0px 8px 15px rgb(255, 255, 0)"
            notificacao.innerText = "ATENÇÃO"
            card.style.boxShadow = "0px 8px 15px rgb(255, 255, 0)"
            card.style.borderColor = "rgb(247, 222, 0)"
            window.console.log("amarelo")

            notificacao.classList.add("notificacao_animacao")   
        }
        function notificacao_vermelho(notificacao, card){
            notificacao.style.background = "rgb(255, 0, 0)"
            notificacao.style.boxShadow = "0px 8px 15px rgb(255, 0, 0)"
            notificacao.innerText = "OFFLINE"
            card.style.boxShadow = "0px 8px 15px rgb(255, 0, 0)"
            card.style.borderColor = "rgb(255, 0, 0)"
            window.console.log("vermelho")
            
            notificacao.classList.add("notificacao_animacao")
        }


        //VARIAVEIS NAVEGACAO
        botao_home = window.document.getElementById("casa")
        botao_dispositivos = window.document.getElementById("dispositivos")
        botao_adicionar = window.document.getElementById("adicionar")
        botao_config = window.document.getElementById("configuracoes")
        botao_sair = window.document.getElementById("sair")
        //LISTAGEM DE EVENTOS NAVEGAÇÃO
        //botao_home.onmousemove = function(){animacao_navegacao(botao_home)}
        //botao_home.onmousedown = function(){animacao_navegacao(botao_home)}

        //FUNÇÕES NAVEGAÇÃO

        function animacao_navegacao(icone){
            icone.classList.add("navegacao_animacao")
            console.log("animacao feita")
        }
        
        
        // ==============================================
        //SERIAL
        //====================================

        const {ipcRenderer} = require('electron');
        //variaveis card 1
        const ph_01 = window.document.getElementById("ph_01")
        const temperatura_01 = window.document.getElementById("temperatura_01")
        const turbidez_01 = window.document.getElementById("turbidez_01")
        //função de adquirir dados / receber de card
        
        
        function dados_atualizacao(){
            const chamada = "atualizar"
            ipcRenderer.send('serial_consulta_de_dado', chamada);
        }
        //ATUALIZAÇÃO CONTINUA DE CARDS
        setInterval(dados_atualizacao, 5000)
        //
        
        
        
        ipcRenderer.on('serial_consulda_de_dado_res', function(event, dado){ 
            atualizacao_de_card(dado)
        })
        
        function atualizacao_de_card(dado){

            // estilo de dados
            //dado{
            //     ph:
            //     temperatura:
            //     turbidez:
            // }
            var ph, temperatura, turbidez

            var dado_json = dado
            var dados = JSON.parse(dado_json);
            //
            var ph = dados.ph
            var temperatura = dados.temperatura
            var turbidez = dados.turbidez
            //

            //atualizaçao de card
            ph_01.innerText = `PH = ${ph}`
            temperatura_01.innerText = `TEMPERATURA = ${temperatura}`
            turbidez_01.innerText = `TURBIDEZ = ${turbidez}`
            
            consulta_dados_definicao(dados)
            return dados
        } 

        //BOTAO ATUALIZAR DADOS CARD
        botao_dados_card = document.getElementById("botao_dados_card")
        botao_dados_card.onclick = function(){dados_atualizacao()}



        //VERIFICANDO DEFINIÇOES

        function consulta_dados_definicao(dados){
            //colsulta definicopes e altera estado do card
            chamada = "consulta_de_dados"
            ipcRenderer.send('consulta_dados_definicoes', chamada);
            ipcRenderer.on('consulta_dados_definicoes_res', function(event, def_res){ 
                
                def_res = def_res.toString()
                var def  = JSON.parse(def_res)
                alterar_estado_card(def, dados)
            })
           
            
        } 
        function alterar_estado_card(def,dados){
            // variavel def - definicoes colocadas pelo usuario
            // variavel dados - dados coletado do arduino e recebido pelo front
            
            //console.log(`testando funcao - ${dados.temperatura} `)
            //console.log(`testando funcao - ${def.temp_min} `)
            if (dados.temperatura < def.temp_min || dados.temperatura>def.temp_max){
                console.log("TEMPERATURA FORA DE ORDEM")
                notificacao_vermelho(notificacao_card_01, card_01)

                notificacao_dados_individuais_vermelho(temperatura_01)
            }
            else{
                notificacao_dados_individuais_verde(temperatura_01)
            }
            if (dados.ph < def.ph_min || dados.ph>def.ph_max){
                console.log("PH FORA DE ORDEM")
                notificacao_vermelho(notificacao_card_01, card_01)

                notificacao_dados_individuais_vermelho(ph_01)
            }
            else{
                notificacao_dados_individuais_verde(ph_01)
            }
            if (dados.turbidez < def.turbidez_min || dados.turbidez>def.turbidez_max){
                console.log("TURBIDEZ FORA DE ORDEM")
                notificacao_vermelho(notificacao_card_01, card_01)

                notificacao_dados_individuais_vermelho(turbidez_01)
            }
            else{
                notificacao_dados_individuais_verde(turbidez_01)
            }

            if (dados.temperatura > def.temp_min && dados.temperatura <def.temp_max
            && dados.ph > def.ph_min && dados.ph <def.ph_max
            && dados.turbidez > def.turbidez_min && dados.turbidez < def.turbidez_max){
                
                console.log("DADOS OK")
                notificacao_verde(notificacao_card_01, card_01)

            }

        }
        //funcoes de tratamento de notificaçoes dos dados individuais
        function notificacao_dados_individuais_vermelho(variavel){
            variavel.style.boxShadow = "0px 8px 15px rgb(255, 0, 0)"
            variavel.style.borderColor = "rgb(255, 0, 0)"
        }
        function notificacao_dados_individuais_verde(variavel){
            variavel.style.boxShadow = "0px 0px 0px rgba(0, 0, 0, 0)"
            variavel.style.borderColor = "rgba(235, 235, 247, 0.459)"
        }
    </script>
        
    
</body>
</html>